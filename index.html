<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI ID Scanner Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: #0f172a; 
            color: #f8fafc; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header { text-align: center; padding: 20px; }
        .header h2 { color: #38bdf8; font-size: 24px; }
        .header p { color: #94a3b8; font-size: 14px; }

        /* Wadah Kamera */
        #camera-wrapper {
            position: relative;
            width: 90%;
            max-width: 400px;
            aspect-ratio: 1.58 / 1; /* Rasio kartu ID */
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid #334155;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        video { width: 100%; height: 100%; object-fit: cover; }

        /* Bingkai Panduan */
        .scan-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border: 2px solid #38bdf8;
            border-radius: 14px;
            box-shadow: 0 0 0 1000px rgba(15, 23, 42, 0.7);
            z-index: 5;
            pointer-events: none;
        }

        .scan-line {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(56, 189, 248, 0.5);
            box-shadow: 0 0 15px #38bdf8;
            animation: scanAnim 2s infinite linear;
            z-index: 6;
            display: none;
        }

        @keyframes scanAnim {
            0% { top: 0; }
            100% { top: 100%; }
        }

        /* Kontrol */
        .controls { width: 90%; max-width: 400px; margin-top: 25px; }
        
        button {
            width: 100%; padding: 18px; border-radius: 12px; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer;
            background: #38bdf8; color: #0f172a;
            box-shadow: 0 4px 14px rgba(56, 189, 248, 0.4);
            transition: 0.3s;
        }
        button:active { transform: scale(0.95); }
        button:disabled { background: #475569; color: #94a3b8; box-shadow: none; }

        /* Hasil Scan */
        #result-box {
            width: 90%; max-width: 400px; background: #1e293b;
            margin-top: 20px; border-radius: 12px; padding: 20px;
            border: 1px solid #334155; display: none;
        }
        .result-item { margin-bottom: 12px; }
        .label { font-size: 11px; color: #38bdf8; text-transform: uppercase; letter-spacing: 1px; }
        .value { font-size: 18px; font-weight: bold; margin-top: 4px; word-break: break-all; }
        
        #status { font-size: 14px; margin-top: 15px; color: #94a3b8; }
    </style>
</head>
<body>

    <div class="header">
        <h2>ID SCANNER PRO</h2>
        <p>Posisikan KTP pas di dalam kotak</p>
    </div>

    <div id="camera-wrapper">
        <video id="webcam" autoplay playsinline></video>
        <div class="scan-overlay"></div>
        <div id="scanner-line" class="scan-line"></div>
    </div>

    <div class="controls">
        <button id="btn-scan">MULAI SCAN ID</button>
        <div id="status" style="text-align: center;">Kamera siap...</div>
    </div>

    <div id="result-box">
        <div class="result-item">
            <div class="label">NIK Terdeteksi</div>
            <div id="nik-result" class="value">Mencari...</div>
        </div>
        <div class="result-item">
            <div class="label">Teks Mentah</div>
            <div id="raw-result" class="value" style="font-size: 12px; font-weight: normal; opacity: 0.7;">-</div>
        </div>
    </div>

    <canvas id="hidden-canvas" style="display:none;"></canvas>

    <script>
        const video = document.getElementById('webcam');
        const btnScan = document.getElementById('btn-scan');
        const status = document.getElementById('status');
        const resultBox = document.getElementById('result-box');
        const scanLine = document.getElementById('scanner-line');
        const canvas = document.getElementById('hidden-canvas');

        // Memulai Kamera
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "environment", width: { ideal: 1280 } },
                    audio: false
                });
                video.srcObject = stream;
            } catch (err) {
                status.innerText = "Gagal akses kamera. Gunakan HTTPS!";
                status.style.color = "#ef4444";
            }
        }

        btnScan.addEventListener('click', async () => {
            // Persiapan UI
            btnScan.disabled = true;
            status.innerText = "Mengambil gambar...";
            scanLine.style.display = "block";
            resultBox.style.display = "none";

            // Ambil Frame dari Video
            const ctx = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            const image = canvas.toDataURL('image/jpeg', 0.9);

            status.innerText = "AI sedang membaca teks...";

            try {
                // Proses OCR
                const worker = await Tesseract.createWorker('ind');
                const { data: { text } } = await worker.recognize(image);
                await worker.terminate();

                // Cari NIK (16 angka) menggunakan Regex
                const nikMatch = text.match(/\d{16}/);
                
                // Tampilkan Hasil
                resultBox.style.display = "block";
                document.getElementById('nik-result').innerText = nikMatch ? nikMatch[0] : "NIK tidak terbaca jelas";
                document.getElementById('raw-result').innerText = text.substring(0, 200) + "...";
                
                status.innerText = "Selesai!";
            } catch (e) {
                status.innerText = "Error saat memproses data.";
                console.error(e);
            } finally {
                btnScan.disabled = false;
                scanLine.style.display = "none";
            }
        });

        initCamera();
    </script>
</body>
  </html>
